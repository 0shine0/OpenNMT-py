

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example: Speech to Text &mdash; OpenNMT-py  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="OpenNMT-py  documentation" href="index.html"/>
        <link rel="next" title="FAQ" href="FAQ.html"/>
        <link rel="prev" title="Example: Image to Text" href="im2text.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> OpenNMT-py
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="main.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="onmt.html">Doc: Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="onmt.modules.html">Doc: Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="onmt.translation.html">Doc: Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="onmt.io.html">Doc: Data Loaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="Library.html">Library: Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="options/preprocess.html">Options: preprocess.py:</a></li>
<li class="toctree-l1"><a class="reference internal" href="options/train.html">Options: train.py:</a></li>
<li class="toctree-l1"><a class="reference internal" href="options/translate.html">Options: translate.py:</a></li>
<li class="toctree-l1"><a class="reference internal" href="extended.html">Example: Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Summarization.html">Example: Summarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="im2text.html">Example: Image to Text</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example: Speech to Text</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#options">Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#acknowledgement">Acknowledgement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTORS.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="ref.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenNMT-py</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Example: Speech to Text</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/speech2text.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example-speech-to-text">
<span id="example-speech-to-text"></span><h1>Example: Speech to Text<a class="headerlink" href="#example-speech-to-text" title="Permalink to this headline">¶</a></h1>
<p>A deep learning-based approach to learning the speech-to-text conversion, built on top of the <a href="http://opennmt.net/">OpenNMT</a> system.</p>
<p>Given raw audio, we first apply short-time Fourier transform (STFT), then apply Convolutional Neural Networks to get the source features. Based on this source representation, we use an LSTM decoder with attention to produce the text character by character.</p>
<div class="section" id="dependencies">
<span id="dependencies"></span><h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">torchaudio</span></code>: <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">sox</span> <span class="pre">libsox-dev</span> <span class="pre">libsox-fmt-all;</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">git+https://github.com/pytorch/audio</span></code></li>
<li><code class="docutils literal"><span class="pre">librosa</span></code>: <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">librosa</span></code></li>
</ul>
</div>
<div class="section" id="quick-start">
<span id="quick-start"></span><h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>To get started, we provide a toy speech-to-text example. We assume that the working directory is <code class="docutils literal"><span class="pre">OpenNMT-py</span></code> throughout this document.</p>
<ol class="simple">
<li>Download the data.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">O</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">.</span><span class="n">tgz</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">lstm</span><span class="o">.</span><span class="n">seas</span><span class="o">.</span><span class="n">harvard</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">latex</span><span class="o">/</span><span class="n">speech</span><span class="o">.</span><span class="n">tgz</span><span class="p">;</span> <span class="n">tar</span> <span class="n">zxf</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">.</span><span class="n">tgz</span> <span class="o">-</span><span class="n">C</span> <span class="n">data</span><span class="o">/</span>
</pre></div>
</div>
<ol class="simple">
<li>Preprocess the data.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">preprocess</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">data_type</span> <span class="n">audio</span> <span class="o">-</span><span class="n">src_dir</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">an4_dataset</span> <span class="o">-</span><span class="n">train_src</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">train</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">train_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">train</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_src</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">val</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">valid_tgt</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">tgt</span><span class="o">-</span><span class="n">val</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">save_data</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">demo</span>
</pre></div>
</div>
<ol class="simple">
<li>Train the model.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">model_type</span> <span class="n">audio</span> <span class="o">-</span><span class="n">data</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">demo</span> <span class="o">-</span><span class="n">save_model</span> <span class="n">demo</span><span class="o">-</span><span class="n">model</span> <span class="o">-</span><span class="n">gpuid</span> <span class="mi">0</span> <span class="o">-</span><span class="n">batch_size</span> <span class="mi">16</span> <span class="o">-</span><span class="n">max_grad_norm</span> <span class="mi">20</span> <span class="o">-</span><span class="n">learning_rate</span> <span class="mf">0.1</span> <span class="o">-</span><span class="n">learning_rate_decay</span> <span class="mf">0.98</span> <span class="o">-</span><span class="n">epochs</span> <span class="mi">60</span>
</pre></div>
</div>
<ol class="simple">
<li>Translate the speechs.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">translate</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">data_type</span> <span class="n">audio</span> <span class="o">-</span><span class="n">model</span> <span class="n">demo</span><span class="o">-</span><span class="n">model_acc_x_ppl_x_e13</span><span class="o">.</span><span class="n">pt</span> <span class="o">-</span><span class="n">src_dir</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">an4_dataset</span> <span class="o">-</span><span class="n">src</span> <span class="n">data</span><span class="o">/</span><span class="n">speech</span><span class="o">/</span><span class="n">src</span><span class="o">-</span><span class="n">val</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">output</span> <span class="n">pred</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">gpu</span> <span class="mi">0</span> <span class="o">-</span><span class="n">verbose</span>
</pre></div>
</div>
</div>
<div class="section" id="options">
<span id="options"></span><h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-src_dir</span></code>: The directory containing the audio files.</li>
<li><code class="docutils literal"><span class="pre">-train_tgt</span></code>: The file storing the tokenized labels, one label per line. It shall look like:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">label0_token0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">label0_token1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="o">&lt;</span><span class="n">label0_tokenN0</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">label1_token0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">label1_token1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="o">&lt;</span><span class="n">label1_tokenN1</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">label2_token0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">label2_token1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="o">&lt;</span><span class="n">label2_tokenN2</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-train_src</span></code>: The file storing the paths of the audio files (relative to <code class="docutils literal"><span class="pre">src_dir</span></code>).</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">speech0_path</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">speech1_path</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">speech2_path</span><span class="o">&gt;</span>
<span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sample_rate</span></code>: Sample rate. Default: 16000.</li>
<li><code class="docutils literal"><span class="pre">window_size</span></code>: Window size for spectrogram in seconds. Default: 0.02.</li>
<li><code class="docutils literal"><span class="pre">window_stride</span></code>: Window stride for spectrogram in seconds. Default: 0.01.</li>
<li><code class="docutils literal"><span class="pre">window</span></code>: Window type for spectrogram generation. Default: hamming.</li>
</ul>
</div>
<div class="section" id="acknowledgement">
<span id="acknowledgement"></span><h2>Acknowledgement<a class="headerlink" href="#acknowledgement" title="Permalink to this headline">¶</a></h2>
<p>Our preprocessing and CNN encoder is adapted from <a class="reference external" href="https://github.com/SeanNaren/deepspeech.pytorch">deepspeech.pytorch</a>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="FAQ.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="im2text.html" class="btn btn-neutral" title="Example: Image to Text" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, srush.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="https://unpkg.com/mermaid@7.1.0/dist/mermaid.min.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>